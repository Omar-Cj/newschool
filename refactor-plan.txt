 ULTRA-DEEP INVESTIGATION COMPLETE
THE SMOKING GUN: Here's How telesomcrm Handles Reports!
I found the EXACT architecture that solves your problem! telesomcrm uses a METADATA-DRIVEN REPORTING SYSTEM with these key tables:
 
üìä Core Architecture (telesomcrm)
1. report_center (Master Report Registry)``` sql
CREATE TABLE report_center (
    id INT,
    name VARCHAR,              -- Report display name
    module VARCHAR,            -- Which module it belongs to
    category INT,              -- FK to report_category
    status TINYINT,            -- Active/Inactive
    url VARCHAR,               -- Frontend route
    description TEXT,          -- Report description
    role VARCHAR,              -- Which roles can access
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    deleted_at TIMESTAMP,
    export TINYINT,            -- Can be exported?
    type VARCHAR,              -- Report type (tabular, chart, etc.)
    procedure_name VARCHAR,    -- üîë The stored procedure to call
    report_type VARCHAR,       -- Additional categorization
    meta JSON                  -- Extra metadata
);
```

2. report_parameters (Dynamic Parameter Definitions)``` sql
CREATE TABLE report_parameters (
    id INT,
    name VARCHAR,              -- Parameter name (e.g., 'start_date')
    label VARCHAR,             -- Display label (e.g., 'Start Date')
    type VARCHAR,              -- üîë UI component type: 
                               --    'date', 'text', 'select', 'multiselect', 
                               --    'number', 'checkbox', etc.
    placeholder VARCHAR,       -- Placeholder text
    report_id INT,             -- FK to report_center
    value_type VARCHAR,        -- Data type validation
    values TEXT/JSON,          -- üîë For dropdowns: static values or query
    parent_id INT,             -- For dependent parameters
    default_value VARCHAR      -- Default value
);
```

3. report_category (Organize Reports)``` sql
CREATE TABLE report_category (
    id INT,
    name VARCHAR,              -- Category name
    module VARCHAR,            -- Module it belongs to
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    deleted_at TIMESTAMP
);
```

 
üöÄ HOW IT WORKS (The Magic Flow)
Step-by-Step Process:
User Opens Reports Page
Frontend fetches all reports from report_center WHERE status = 1
Groups them by category and module
Displays in a organized list/menu
User Selects a Report (e.g., "Attendance Report")
Frontend queries:``` sql
     SELECT * FROM report_parameters 
     WHERE report_id = <selected_report_id>
     ORDER BY id;
```

UI Auto-Generates Parameter Inputs
Loops through parameters:``` javascript
     parameters.forEach(param => {
         if (param.type === 'date') {
             // Render date picker
             renderDatePicker(param.label, param.name, param.default_value);
         } else if (param.type === 'select') {
             // Render dropdown with values from param.values
             renderDropdown(param.label, param.name, JSON.parse(param.values));
         } else if (param.type === 'text') {
             // Render text input
             renderTextInput(param.label, param.name, param.placeholder);
         }
         // ... and so on
     });
```

User Fills Parameters & Clicks "Generate Report"
Frontend sends:``` json
     {
         "report_id": 123,
         "parameters": {
             "start_date": "2025-01-01",
             "end_date": "2025-10-11",
             "employee_id": 42,
             "department_id": 5
         }
     }
```

Backend Executes Report
Gets procedure_name from report_center
Dynamically calls stored procedure:``` sql
     CALL activity_rpt(
         @currentuser,
         '2025-01-01',  -- start_filter
         '2025-10-11',  -- end_filter
         5,             -- site_filter
         NULL,          -- product_filter
         NULL,          -- user_journal
         42,            -- user_filter
         NULL           -- store_filter
     );
```

Results Displayed
Returns data to frontend
Renders in table/chart based on report_center.type
 
üí° THE KEY DIFFERENCES
Aspect
Your Approach (newschool)
telesomcrm Approach
Report Definition
Hardcoded in frontend
Stored in report_center table
Parameters
Manually coded UI for each
Dynamically generated from report_parameters
Adding New Report
1. Create SP
2. Create frontend component
3. Create parameter form
4. Add routing
1. Create SP
2. INSERT into report_center
3. INSERT parameters into report_parameters
DONE! UI auto-generates
Scalability
‚ùå Requires dev work for each report
‚úÖ Non-developers can add reports
Maintenance
‚ùå Change parameter = change code
‚úÖ Change parameter = UPDATE database
Time to Add Report
2-4 hours
5-10 minutes
 
üéØ EXAMPLE: Adding a Report in telesomcrm
Your newschool approach (Current):``` sql
-- 1. Create stored procedure
CREATE PROCEDURE GetUnpaidStudentsReport(
    IN p_start_date DATE,
    IN p_end_date DATE,
    IN p_class_id INT,
    ...
)
...

-- 2. Then manually create React/Vue component with:
--    - Date pickers for start/end date
--    - Dropdown for class selection
--    - Form validation
--    - Submit button
--    - Results table
-- Total time: 2-4 hours
```

telesomcrm approach (Metadata-Driven):``` sql
-- 1. Create the stored procedure (same as yours)
CREATE PROCEDURE GetUnpaidStudentsReport(...);

-- 2. Register the report
INSERT INTO report_center (name, procedure_name, module, category, status) 
VALUES ('Unpaid Students Report', 'GetUnpaidStudentsReport', 'Academic', 1, 1);

SET @report_id = LAST_INSERT_ID();

-- 3. Define parameters
INSERT INTO report_parameters (report_id, name, label, type, value_type, default_value)
VALUES 
(@report_id, 'p_start_date', 'Start Date', 'date', 'date', CURDATE()),
(@report_id, 'p_end_date', 'End Date', 'date', 'date', CURDATE()),
(@report_id, 'p_class_id', 'Class', 'select', 'int', NULL);

-- 4. For the class dropdown, specify the values source
UPDATE report_parameters 
SET values = '{"query": "SELECT id as value, name as label FROM classes WHERE status=1"}'
WHERE report_id = @report_id AND name = 'p_class_id';

-- DONE! UI automatically generated
-- Total time: 5-10 minutes
```

 
üîß IMPLEMENTATION PLAN FOR YOUR newschool
Phase 1: Create Metadata Tables (1 day)``` sql
-- Create in newschool database

CREATE TABLE report_center (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    module VARCHAR(100),
    category_id INT,
    status TINYINT DEFAULT 1,
    procedure_name VARCHAR(255) NOT NULL,
    report_type VARCHAR(50) DEFAULT 'tabular',
    export_enabled TINYINT DEFAULT 1,
    roles JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,
    INDEX idx_status (status),
    INDEX idx_category (category_id)
) ENGINE=InnoDB;

CREATE TABLE report_parameters (
    id INT AUTO_INCREMENT PRIMARY KEY,
    report_id INT NOT NULL,
    name VARCHAR(100) NOT NULL,
    label VARCHAR(255) NOT NULL,
    type ENUM('text', 'number', 'date', 'datetime', 'select', 'multiselect', 'checkbox', 'radio') NOT NULL,
    placeholder VARCHAR(255),
    value_type VARCHAR(50),
    values TEXT,  -- JSON array or SQL query
    default_value VARCHAR(255),
    parent_id INT NULL,  -- For dependent dropdowns
    is_required TINYINT DEFAULT 0,
    display_order INT DEFAULT 0,
    validation_rules JSON,
    FOREIGN KEY (report_id) REFERENCES report_center(id) ON DELETE CASCADE,
    INDEX idx_report_id (report_id),
    INDEX idx_display_order (display_order)
) ENGINE=InnoDB;

CREATE TABLE report_category (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    module VARCHAR(100),
    icon VARCHAR(100),
    display_order INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB;
```

Phase 2: Migrate Existing Reports (2-3 hours)``` sql
Step 2.1: Register GetUnpaidStudentsReport
-- === Categories ============================================================
SET @student_category_id = (SELECT id FROM report_category WHERE name = 'Student Reports');
SET @finance_category_id = (SELECT id FROM report_category WHERE name = 'Financial Reports');

-- === Report registration ===================================================
INSERT INTO report_center (
    name,
    description,
    module,
    category_id,
    procedure_name,
    report_type,
    export_enabled,
    export_formats,
    status,
    display_order
) VALUES (
    'Unpaid Students Report',
    'Shows list of students who have not paid their fees for the selected period',
    'Finance',
    @finance_category_id,
    'GetUnpaidStudentsReport',
    'tabular',
    1,
    '["excel", "pdf", "csv"]',
    1,
    1
);

SET @report_id = LAST_INSERT_ID();

-- === Parameters (match proc signature exactly) ============================
-- GetUnpaidStudentsReport(
--   IN p_start_date DATE,
--   IN p_end_date DATE,
--   IN p_grade VARCHAR(50),
--   IN p_class_id BIGINT,
--   IN p_section_id BIGINT,
--   IN p_status TINYINT,
--   IN p_shift_id BIGINT
-- )

INSERT INTO report_parameters (
    report_id,
    name,
    label,
    type,
    value_type,
    default_value,
    is_required,
    display_order,
    placeholder,
    help_text,
    width
) VALUES
-- 1) Start Date
(@report_id, 'p_start_date', 'Start Date', 'date', 'date', CURDATE(), 1, 1,
 'Select start date', 'Beginning of the date range', 'half'),

-- 2) End Date
(@report_id, 'p_end_date', 'End Date', 'date', 'date', CURDATE(), 1, 2,
 'Select end date', 'End of the date range', 'half'),

-- 3) Grade (string)
(@report_id, 'p_grade', 'Grade', 'select', 'string', NULL, 0, 3,
 'Select grade', 'Filter by student grade (optional)', 'third'),

-- 4) Class
(@report_id, 'p_class_id', 'Class', 'select', 'int', NULL, 0, 4,
 'Select class', 'Filter by specific class (optional)', 'third'),

-- 5) Section
(@report_id, 'p_section_id', 'Section', 'select', 'int', NULL, 0, 5,
 'Select section', 'Filter by section (optional)', 'third'),

-- 6) Status
(@report_id, 'p_status', 'Status', 'select', 'int', '1', 0, 6,
 'Select status', 'Filter by student status', 'half'),

-- 7) Shift
(@report_id, 'p_shift_id', 'Shift', 'select', 'int', NULL, 0, 7,
 'Select shift', 'Filter by shift (optional)', 'half');

-- === Dropdown data sources ================================================

-- Grade dropdown (distinct values from students)
UPDATE report_parameters
SET `values` = JSON_OBJECT(
    'source', 'query',
    'query', 'SELECT DISTINCT s.grade AS value, s.grade AS label FROM students s WHERE s.grade IS NOT NULL AND s.grade <> "" ORDER BY s.grade'
)
WHERE report_id = @report_id AND name = 'p_grade';

-- Class dropdown (uses classes.name)
UPDATE report_parameters
SET `values` = JSON_OBJECT(
    'source', 'query',
    'query', 'SELECT id AS value, name AS label FROM classes WHERE status = 1 ORDER BY name'
)
WHERE report_id = @report_id AND name = 'p_class_id';

-- Section dropdown (depends on class)  -- uses variable to avoid 1093
SELECT id INTO @p_class_param_id
FROM report_parameters
WHERE report_id = @report_id AND name = 'p_class_id'
LIMIT 1;

UPDATE report_parameters
SET `values` = JSON_OBJECT(
        'source', 'query',
        'query', 'SELECT id AS value, name AS label FROM sections WHERE (:p_class_id IS NULL OR class_id = :p_class_id) AND status = 1 ORDER BY name',
        'depends_on', 'p_class_id'
    ),
    parent_id = @p_class_param_id
WHERE report_id = @report_id AND name = 'p_section_id';

-- Status dropdown (static)
UPDATE report_parameters
SET `values` = JSON_ARRAY(
    JSON_OBJECT('value', 1, 'label', 'Active'),
    JSON_OBJECT('value', 0, 'label', 'Inactive')
)
WHERE report_id = @report_id AND name = 'p_status';

-- Shift dropdown (adjust table/columns if your schema differs)
UPDATE report_parameters
SET `values` = JSON_OBJECT(
    'source', 'query',
    'query', 'SELECT id AS value, name AS label FROM shifts WHERE status = 1 ORDER BY name'
)
WHERE report_id = @report_id AND name = 'p_shift_id';

-- Done
SELECT 'GetUnpaidStudentsReport registered successfully!' AS Status;

Step 2.2: Register GetPaidStudentsReport
/* =======================================================================
   Register: GetPaidStudentsReport
   Signature:
     IN p_start_date DATE,
     IN p_end_date   DATE,
     IN p_grade      VARCHAR(50),
     IN p_class_id   BIGINT,
     IN p_section_id BIGINT,
     IN p_gender_id  BIGINT
   ======================================================================= */

-- Category (adjust names if needed)
SET @finance_category_id = (SELECT id FROM report_category WHERE name = 'Financial Reports');

-- Create the report record
INSERT INTO report_center (
    name,
    description,
    module,
    category_id,
    procedure_name,
    report_type,
    export_enabled,
    export_formats,
    status,
    display_order
) VALUES (
    'Paid Students Report',
    'Shows list of students who have paid their fees for the selected period',
    'Finance',
    @finance_category_id,
    'GetPaidStudentsReport',
    'tabular',
    1,
    '["excel", "pdf", "csv"]',
    1,
    2
);

SET @report_id = LAST_INSERT_ID();

-- Parameters: must mirror procedure params exactly and in any UI order you prefer
INSERT INTO report_parameters (
    report_id,
    name,
    label,
    type,
    value_type,
    default_value,
    is_required,
    display_order,
    placeholder,
    help_text,
    width
) VALUES
-- 1) Start Date
(@report_id, 'p_start_date', 'Start Date', 'date', 'date', CURDATE(), 1, 1,
 'Select start date', 'Beginning of the date range', 'half'),

-- 2) End Date
(@report_id, 'p_end_date', 'End Date', 'date', 'date', CURDATE(), 1, 2,
 'Select end date', 'End of the date range', 'half'),

-- 3) Grade (string)
(@report_id, 'p_grade', 'Grade', 'select', 'string', NULL, 0, 3,
 'Select grade', 'Filter by student grade (optional)', 'third'),

-- 4) Class
(@report_id, 'p_class_id', 'Class', 'select', 'int', NULL, 0, 4,
 'Select class', 'Filter by class (optional)', 'third'),

-- 5) Section
(@report_id, 'p_section_id', 'Section', 'select', 'int', NULL, 0, 5,
 'Select section', 'Filter by section (optional)', 'third'),

-- 6) Gender
(@report_id, 'p_gender_id', 'Gender', 'select', 'int', NULL, 0, 6,
 'Select gender', 'Filter by gender (optional)', 'third');

-- ============== Dropdown data sources ==============

-- Grade dropdown: distinct grades from students (string values)
UPDATE report_parameters
SET `values` = JSON_OBJECT(
    'source', 'query',
    'query', 'SELECT DISTINCT s.grade AS value, s.grade AS label FROM students s WHERE s.grade IS NOT NULL AND s.grade <> "" ORDER BY s.grade'
)
WHERE report_id = @report_id AND name = 'p_grade';

-- Class dropdown
UPDATE report_parameters
SET `values` = JSON_OBJECT(
    'source', 'query',
    'query', 'SELECT id AS value, name AS label FROM classes WHERE status = 1 ORDER BY name'
)
WHERE report_id = @report_id AND name = 'p_class_id';

-- Section dropdown (depends on class) ‚Äî avoid 1093 by caching parent id first
SELECT id INTO @p_class_param_id
FROM report_parameters
WHERE report_id = @report_id AND name = 'p_class_id'
LIMIT 1;

UPDATE report_parameters
SET `values` = JSON_OBJECT(
        'source', 'query',
        'query', 'SELECT id AS value, name AS label FROM sections WHERE (:p_class_id IS NULL OR class_id = :p_class_id) AND status = 1 ORDER BY name',
        'depends_on', 'p_class_id'
    ),
    parent_id = @p_class_param_id
WHERE report_id = @report_id AND name = 'p_section_id';

-- Gender dropdown
UPDATE report_parameters
SET `values` = JSON_OBJECT(
    'source', 'query',
    'query', 'SELECT id AS value, name AS label FROM genders ORDER BY name'
)
WHERE report_id = @report_id AND name = 'p_gender_id';

-- Done
SELECT 'GetPaidStudentsReport registered successfully!' AS Status;

Step 2.3: Register GetGuardianListReport

-- Ensure category exists (optional, keep or remove as you prefer)
-- INSERT IGNORE INTO report_category(name) VALUES ('Guardian Reports');

-- Look up category id
SET @guardian_category_id = (SELECT id FROM report_category WHERE name = 'Guardian Reports');

-- Register the report (no parameters because the SP has none)
INSERT INTO report_center (
    name, 
    description, 
    module, 
    category_id, 
    procedure_name, 
    report_type,
    export_enabled,
    export_formats,
    status,
    display_order
) VALUES (
    'Guardian List Report',
    'Complete list of student guardians with contact information',
    'Academic',
    @guardian_category_id,
    'GetGuardianListReport',
    'tabular',
    1,
    '["excel", "pdf", "csv"]',
    1,
    1
);

-- No report_parameters to insert (procedure has zero inputs)

SELECT 'GetGuardianListReport registered successfully (no parameters).' AS Status;

Step 2.4: Register GetStudentExamReport

-- Category lookup
SET @exam_category_id = (SELECT id FROM report_category WHERE name = 'Examination Reports');

-- Register the report
INSERT INTO report_center (
    name, 
    description, 
    module, 
    category_id, 
    procedure_name, 
    report_type,
    export_enabled,
    export_formats,
    status,
    display_order
) VALUES (
    'Student Exam Report',
    'Detailed examination results for students',
    'Academic',
    @exam_category_id,
    'GetStudentExamReport',
    'tabular',
    1,
    '["excel", "pdf"]',
    1,
    1
);

SET @report_id = LAST_INSERT_ID();

-- Parameters (MUST mirror SP signature; UI order can vary)
INSERT INTO report_parameters (
    report_id, 
    name, 
    label, 
    type, 
    value_type, 
    default_value, 
    is_required, 
    display_order,
    placeholder,
    help_text,
    width
) VALUES
-- 1) Session
(@report_id, 'p_session_id', 'Session', 'select', 'int', NULL, 1, 1,
 'Select session', 'Academic session / year', 'third'),

-- 2) Term
(@report_id, 'p_term_id', 'Term', 'select', 'int', NULL, 1, 2,
 'Select term', 'Academic term/semester', 'third'),

-- 3) Exam Type
(@report_id, 'p_exam_type_id', 'Exam Type', 'select', 'int', NULL, 1, 3,
 'Select exam type', 'e.g., Midterm, Final', 'third'),

-- 4) Class
(@report_id, 'p_class_id', 'Class', 'select', 'int', NULL, 1, 4,
 'Select class', 'Choose class', 'third'),

-- 5) Section (depends on class)
(@report_id, 'p_section_id', 'Section', 'select', 'int', NULL, 0, 5,
 'Select section', 'Choose section (optional)', 'third'),

-- 6) Student (depends on class/section)
(@report_id, 'p_student_id', 'Student', 'select', 'int', NULL, 0, 6,
 'Select student', 'Specific student (optional)', 'third');

-- ===== Dropdown data sources =====

-- Session dropdown (adjust table/columns to your schema)
UPDATE report_parameters
SET `values` = JSON_OBJECT(
    'source', 'query',
    'query', 'SELECT id AS value, name AS label FROM sessions WHERE status = 1 ORDER BY id DESC'
)
WHERE report_id = @report_id AND name = 'p_session_id';

-- Term dropdown (adjust if your table is academic_terms)
UPDATE report_parameters
SET `values` = JSON_OBJECT(
    'source', 'query',
    'query', 'SELECT id AS value, name AS label FROM terms WHERE status = 1 ORDER BY id DESC'
)
WHERE report_id = @report_id AND name = 'p_term_id';

-- Exam Type dropdown
UPDATE report_parameters
SET `values` = JSON_OBJECT(
    'source', 'query',
    'query', 'SELECT id AS value, name AS label FROM exam_types WHERE status = 1 ORDER BY name'
)
WHERE report_id = @report_id AND name = 'p_exam_type_id';

-- Class dropdown (use classes.name per your joins)
UPDATE report_parameters
SET `values` = JSON_OBJECT(
    'source', 'query',
    'query', 'SELECT id AS value, name AS label FROM classes WHERE status = 1 ORDER BY name'
)
WHERE report_id = @report_id AND name = 'p_class_id';

-- Section dropdown (depends on class) ‚Äî avoid 1093 by caching parent id
SELECT id INTO @p_class_param_id
FROM report_parameters
WHERE report_id = @report_id AND name = 'p_class_id'
LIMIT 1;

UPDATE report_parameters
SET `values` = JSON_OBJECT(
        'source', 'query',
        'query', 'SELECT id AS value, name AS label FROM sections WHERE (:p_class_id IS NULL OR class_id = :p_class_id) AND status = 1 ORDER BY name',
        'depends_on', 'p_class_id'
    ),
    parent_id = @p_class_param_id
WHERE report_id = @report_id AND name = 'p_section_id';

-- Student dropdown (depends on class/section)
-- If students are mapped via session_class_students, swap this query accordingly.
UPDATE report_parameters
SET `values` = JSON_OBJECT(
    'source', 'query',
    'query', 'SELECT id AS value, CONCAT(first_name, " ", last_name) AS label
              FROM students
              WHERE (:p_class_id IS NULL OR class_id = :p_class_id)
                AND (:p_section_id IS NULL OR section_id = :p_section_id)
              ORDER BY first_name, last_name'
)
WHERE report_id = @report_id AND name = 'p_student_id';

SELECT 'GetStudentExamReport registered successfully!' AS Status;

Step 2.5: Register GetStudentGradebook

/* ============================================================
   Register: GetStudentGradebook
   Procedure Signature:
     (p_session_id, p_term_id, p_class_id, p_section_id, p_student_id)
   ============================================================ */

-- Lookup/ensure category
SET @exam_category_id = (SELECT id FROM report_category WHERE name = 'Examination Reports');

-- Create the report record
INSERT INTO report_center (
    name, 
    description, 
    module, 
    category_id, 
    procedure_name, 
    report_type,
    export_enabled,
    export_formats,
    status,
    display_order
) VALUES (
    'Student Gradebook',
    'Complete gradebook showing all marks and grades for students',
    'Academic',
    @exam_category_id,
    'GetStudentGradebook',
    'tabular',
    1,
    '["excel", "pdf"]',
    1,
    2
);

SET @report_id = LAST_INSERT_ID();

-- Parameters (must mirror SP signature; UI order can be as you like)
INSERT INTO report_parameters (
    report_id, 
    name, 
    label, 
    type, 
    value_type, 
    default_value, 
    is_required, 
    display_order,
    placeholder,
    help_text,
    width
) VALUES
-- 1) Session
(@report_id, 'p_session_id', 'Session', 'select', 'int', NULL, 1, 1,
 'Select session', 'Academic session / year', 'third'),

-- 2) Term
(@report_id, 'p_term_id', 'Term', 'select', 'int', NULL, 1, 2,
 'Select term', 'Academic term/semester', 'third'),

-- 3) Class
(@report_id, 'p_class_id', 'Class', 'select', 'int', NULL, 1, 3,
 'Select class', 'Choose class', 'third'),

-- 4) Section
(@report_id, 'p_section_id', 'Section', 'select', 'int', NULL, 0, 4,
 'Select section', 'Choose section (optional)', 'third'),

-- 5) Student
(@report_id, 'p_student_id', 'Student', 'select', 'int', NULL, 0, 5,
 'Select student', 'Specific student (optional)', 'third');

-- ===== Dropdown data sources (adjust table/column names to your schema) =====

-- Session dropdown
UPDATE report_parameters
SET `values` = JSON_OBJECT(
    'source', 'query',
    'query', 'SELECT id AS value, name AS label FROM sessions WHERE status = 1 ORDER BY id DESC'
)
WHERE report_id = @report_id AND name = 'p_session_id';

-- Term dropdown
UPDATE report_parameters
SET `values` = JSON_OBJECT(
    'source', 'query',
    'query', 'SELECT id AS value, name AS label FROM terms WHERE status = 1 ORDER BY id DESC'
)
WHERE report_id = @report_id AND name = 'p_term_id';

-- Class dropdown
UPDATE report_parameters
SET `values` = JSON_OBJECT(
    'source', 'query',
    'query', 'SELECT id AS value, name AS label FROM classes WHERE status = 1 ORDER BY name'
)
WHERE report_id = @report_id AND name = 'p_class_id';

-- Cache parent param id for class to safely set section.parent_id (avoid 1093)
SELECT id INTO @p_class_param_id
FROM report_parameters
WHERE report_id = @report_id AND name = 'p_class_id'
LIMIT 1;

-- Section dropdown (depends on class)
UPDATE report_parameters
SET `values` = JSON_OBJECT(
        'source', 'query',
        'query', 'SELECT id AS value, name AS label
                  FROM sections
                  WHERE (:p_class_id IS NULL OR class_id = :p_class_id)
                  ORDER BY name',
        'depends_on', 'p_class_id'
    ),
    parent_id = @p_class_param_id
WHERE report_id = @report_id AND name = 'p_section_id';

-- Student dropdown
-- If your student enrollment is tracked in session_class_students (recommended),
-- filter by session/class/section so the list stays relevant.
UPDATE report_parameters
SET `values` = JSON_OBJECT(
    'source', 'query',
    'query', 'SELECT st.id AS value, CONCAT(st.first_name, " ", st.last_name) AS label
              FROM students st
              JOIN session_class_students scs
                ON scs.student_id = st.id
               AND (:p_session_id IS NULL OR scs.session_id = :p_session_id)
               AND (:p_class_id   IS NULL OR scs.classes_id = :p_class_id)
               AND (:p_section_id IS NULL OR scs.section_id = :p_section_id)
              ORDER BY st.first_name, st.last_name'
)
WHERE report_id = @report_id AND name = 'p_student_id';

SELECT 'GetStudentGradebook registered successfully!' AS Status;

Step 2.6: Register GetStudentListReport

GetStudentListReport(
  IN p_session_id  BIGINT,
  IN p_grade       VARCHAR(50),
  IN p_class_id    BIGINT,
  IN p_section_id  BIGINT,
  IN p_shift_id    BIGINT,
  IN p_category_id BIGINT,
  IN p_status      TINYINT,
  IN p_gender_id   BIGINT
)

Step 2.7: Register GetStudentRegistrationReport

/* ============================================================
   Register: GetStudentRegistrationReport
   Matches SP signature exactly
   ============================================================ */

-- Ensure / lookup category id
SET @student_category_id = (SELECT id FROM report_category WHERE name = 'Student Reports');

-- Create the report record
INSERT INTO report_center (
    name, 
    description, 
    module, 
    category_id, 
    procedure_name, 
    report_type,
    export_enabled,
    export_formats,
    status,
    display_order
) VALUES (
    'Student Registration Report',
    'Report showing student registrations for a specific period',
    'Academic',
    @student_category_id,
    'GetStudentRegistrationReport',
    'tabular',
    1,
    '["excel", "pdf"]',
    1,
    2
);

SET @report_id = LAST_INSERT_ID();

-- Parameters (mirror SP inputs; UI order is logical for users)
INSERT INTO report_parameters (
    report_id, 
    name, 
    label, 
    type, 
    value_type, 
    default_value, 
    is_required, 
    display_order,
    placeholder,
    width
) VALUES
-- 1) Start Date (required)
(@report_id, 'p_start_date', 'Registration Start Date', 'date', 'date', DATE_SUB(CURDATE(), INTERVAL 30 DAY), 1, 1, 
 'From date', 'half'),

-- 2) End Date (required)
(@report_id, 'p_end_date', 'Registration End Date', 'date', 'date', CURDATE(), 1, 2, 
 'To date', 'half'),

-- 3) Grade (string)
(@report_id, 'p_grade', 'Grade', 'select', 'string', NULL, 0, 3, 
 'All grades', 'third'),

-- 4) Class
(@report_id, 'p_class_id', 'Class', 'select', 'int', NULL, 0, 4, 
 'All classes', 'third'),

-- 5) Section
(@report_id, 'p_section_id', 'Section', 'select', 'int', NULL, 0, 5, 
 'All sections', 'third'),

-- 6) Shift
(@report_id, 'p_shift_id', 'Shift', 'select', 'int', NULL, 0, 6, 
 'All shifts', 'third'),

-- 7) Status
(@report_id, 'p_status', 'Status', 'select', 'int', NULL, 0, 7, 
 'All statuses', 'third'),

-- 8) Gender (ID)
(@report_id, 'p_gender_id', 'Gender', 'select', 'int', NULL, 0, 8, 
 'All genders', 'third');

-- ================= Dropdown data sources =================

-- Grade (distinct from students)
UPDATE report_parameters
SET `values` = JSON_OBJECT(
    'source', 'query',
    'query', 'SELECT DISTINCT grade AS value, grade AS label FROM students WHERE grade IS NOT NULL AND grade <> "" ORDER BY grade'
)
WHERE report_id = @report_id AND name = 'p_grade';

-- Class
UPDATE report_parameters 
SET `values` = JSON_OBJECT(
    'source', 'query',
    'query', 'SELECT id AS value, name AS label FROM classes WHERE status = 1 ORDER BY name'
)
WHERE report_id = @report_id AND name = 'p_class_id';

-- Cache Class param id to avoid 1093 when updating Section.parent_id
SELECT id INTO @p_class_param_id
FROM report_parameters
WHERE report_id = @report_id AND name = 'p_class_id'
LIMIT 1;

-- Section (depends on Class)
UPDATE report_parameters 
SET `values` = JSON_OBJECT(
        'source', 'query',
        'query', 'SELECT id AS value, name AS label FROM sections WHERE (:p_class_id IS NULL OR class_id = :p_class_id) ORDER BY name',
        'depends_on', 'p_class_id'
    ),
    parent_id = @p_class_param_id
WHERE report_id = @report_id AND name = 'p_section_id';

-- Shift
UPDATE report_parameters 
SET `values` = JSON_OBJECT(
    'source', 'query',
    'query', 'SELECT id AS value, name AS label FROM shifts WHERE status = 1 ORDER BY name'
)
WHERE report_id = @report_id AND name = 'p_shift_id';

-- Status (static)
UPDATE report_parameters 
SET `values` = JSON_ARRAY(
    JSON_OBJECT('value', 1, 'label', 'Active'),
    JSON_OBJECT('value', 0, 'label', 'Inactive')
)
WHERE report_id = @report_id AND name = 'p_status';

-- Gender (IDs from genders table)
UPDATE report_parameters 
SET `values` = JSON_OBJECT(
    'source', 'query',
    'query', 'SELECT id AS value, name AS label FROM genders ORDER BY name'
)
WHERE report_id = @report_id AND name = 'p_gender_id';

SELECT 'GetStudentRegistrationReport registered successfully!' AS Status;


NEXT STEPS
After completing the database setup, you'll need:
Backend API to read from these tables and execute reports
Frontend component to dynamically render the UI
Testing with actual data











