# PDF Export Testing Checklist

**Quick Reference Guide for Manual Testing**

---

## Test Setup

### Prerequisites
- Access to school management system
- Valid student ID with gradebook data
- Test report configured with summary calculations
- Browser with PDF viewer

### Test URL Pattern
```
https://your-domain.com/reports/{report_id}/export?format=pdf&p_student_id={student_id}
```

---

## Quick Test Scenarios

### ✅ Test 1: Standard Export (MUST PASS)

**Setup:**
- Use existing student with complete name
- Run gradebook report with exams

**Check:**
1. PDF title = "[Student Full Name] Gradebook"
2. Summary table appears after main data
3. Summary has 2 columns: "Exam Name" | "Total Mark"
4. "Total All Exams" row is bold with border
5. No PHP errors

**Pass Criteria:** All 5 checks pass

---

### ✅ Test 2: Missing Student (SHOULD PASS)

**Setup:**
- Use non-existent student ID (e.g., 99999)
- Check logs at `storage/logs/laravel.log`

**Check:**
1. PDF title = "Student Gradebook" (generic)
2. No student name header
3. Log entry: "Student not found for PDF export"
4. Export completes without crash
5. Summary still displays

**Pass Criteria:** Graceful degradation, no errors

---

### ✅ Test 3: No Summary Data (SHOULD PASS)

**Setup:**
- Report without summary calculations
- Valid student ID

**Check:**
1. PDF title shows student name
2. No summary section appears
3. Main data table displays
4. No errors logged
5. Clean PDF output

**Pass Criteria:** Clean render without summary

---

## Visual Inspection Guide

### PDF Layout Checklist

```
┌─────────────────────────────────────┐
│  [School Logo]                      │
│                                     │
│  [Student Name] Gradebook          │ ← Check: Student name appears
│  Complete gradebook showing...      │
├─────────────────────────────────────┤
│  Generated: 2025-10-13 14:30:00    │
│  Generated By: Admin User           │
│  Session: 2024-2025                 │ ← Check: Parameters shown
│  Student: John Doe                  │
├─────────────────────────────────────┤
│                                     │
│  [MAIN DATA TABLE]                 │
│  Exam | Subject | Mark | Grade     │ ← Check: Main table
│  ---------------------------------- │
│  ...rows...                        │
│                                     │
├─────────────────────────────────────┤
│  Exam Summary                      │ ← Check: Section exists
│  ┌──────────────┬─────────────┐   │
│  │ Exam Name    │ Total Mark  │   │ ← Check: 2 columns
│  ├──────────────┼─────────────┤   │
│  │ Midterm      │         95  │   │
│  │ Final        │         88  │   │
│  ├──────────────┼─────────────┤   │
│  │ Total All    │        183  │   │ ← Check: Bold + border
│  └──────────────┴─────────────┘   │
└─────────────────────────────────────┘
```

---

## Common Issues & Quick Fixes

### Issue 1: Student name is "null" or missing

**Check:**
1. Verify student exists in database
2. Check student has `first_name` or `last_name`
3. Review logs for "Student not found"

**Expected Behavior:** Falls back to generic report name

---

### Issue 2: Summary table not showing

**Check:**
1. Verify `$metadata['summary']` exists in controller
2. Check summary has `rows` key with array
3. Confirm array not empty

**Expected Behavior:** Section hidden if no data

---

### Issue 3: Summary shows 4 columns instead of 2

**Check:**
1. Verify using correct template (`resources/views/reports/pdf/template.blade.php`)
2. Check template lines 342-346 (should be 2 columns)
3. Clear view cache: `php artisan view:clear`

**Expected Behavior:** Only "Exam Name" and "Total Mark" columns

---

### Issue 4: "Total All Exams" not bold

**Check:**
1. Verify last row in summary has `exam_name = 'Total All Exams'`
2. Check template line 351-352 (total row detection)
3. Inspect CSS class `.total-all-exams-row`

**Expected Behavior:** Bold text, darker border

---

## Log Monitoring

### Key Log Entries to Watch

**Location:** `storage/logs/laravel.log`

**Success Pattern:**
```
[INFO] Report export initiated
  - report_id: 1
  - format: pdf
  - row_count: 45

[DEBUG] PDF export with summary data
  - report_id: 1
  - summary_rows: 3
  - grand_total: 183.5

[DEBUG] Student name resolved
  - student_id: 123
  - student_name: "John Doe"
```

**Warning Pattern:**
```
[WARNING] Student not found for PDF export
  - student_id: 99999
```

**Error Pattern:**
```
[ERROR] PDF export failed
  - report_id: 1
  - error: "Database connection failed"
```

---

## Quick Debug Commands

### Check Database
```bash
# Verify student exists
php artisan tinker
>>> DB::table('students')->where('id', 123)->first()

# Check name fields
>>> Student::find(123)->only(['first_name', 'last_name'])
```

### Check Template
```bash
# Clear cached views
php artisan view:clear

# Verify template exists
ls -la resources/views/reports/pdf/template.blade.php
```

### Check Logs
```bash
# Tail live logs during export
tail -f storage/logs/laravel.log | grep "PDF export"

# Search for student resolution
grep "Student name" storage/logs/laravel.log
```

---

## Performance Benchmarks

### Expected Metrics

| Rows | Summary Lines | Expected Time | Max Memory |
|------|---------------|---------------|------------|
| 50   | 3             | <5s           | 64MB       |
| 500  | 10            | <15s          | 128MB      |
| 1500 | 20            | <30s          | 256MB      |
| 2000 | (limit)       | <45s          | 256MB      |

**Note:** Exports >2000 rows are blocked by service

---

## Test Data Preparation

### Create Test Student
```sql
INSERT INTO students (first_name, last_name, admission_no, email)
VALUES ('Test', 'Student', 'TEST001', 'test@example.com');
```

### Create Test Summary Data
```php
// In your controller before export
$metadata = [
    'name' => 'Student Gradebook',
    'parameters' => [
        'p_student_id' => 123,
        'p_session_id' => 1
    ],
    'summary' => [
        'rows' => [
            ['exam_name' => 'Unit Test 1', 'total_marks' => 85],
            ['exam_name' => 'Unit Test 2', 'total_marks' => 90],
            ['exam_name' => 'Midterm', 'total_marks' => 92],
            ['exam_name' => 'Final Exam', 'total_marks' => 88],
            ['exam_name' => 'Total All Exams', 'total_marks' => 355]
        ]
    ]
];
```

---

## Sign-Off Checklist

### Before Deployment

- [ ] Test 1 (Standard) passes
- [ ] Test 2 (Missing student) passes
- [ ] Test 3 (No summary) passes
- [ ] Visual layout matches diagram
- [ ] No PHP errors in logs
- [ ] Performance within benchmarks
- [ ] Cross-browser PDF rendering tested
- [ ] Large dataset (1000+ rows) tested

### Stakeholder Review

- [ ] Sample PDFs reviewed by product owner
- [ ] Student name format approved
- [ ] Summary layout approved
- [ ] Number formatting approved

---

## Contacts for Issues

| Issue Type | Contact | Notes |
|------------|---------|-------|
| Database schema | DBA team | Student table changes |
| Template styling | Frontend team | CSS/layout issues |
| Export logic | Backend team | Service modifications |
| Performance | DevOps | Memory/timeout issues |

---

**Last Updated:** 2025-10-13
**Testing Template Version:** 1.0
**Compatible with:** Laravel 10+, DomPDF 2.x
