<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="sample-csrf-token">
    <title>Report Display Component - Example</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Print Stylesheet -->
    <link rel="stylesheet" href="../css/reports-print.css" media="print">

    <style>
        body {
            padding: 20px;
            background-color: #f8f9fa;
        }

        .demo-section {
            margin-bottom: 40px;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .demo-section h2 {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #007bff;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.9em;
        }

        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- Header -->
        <div class="demo-section">
            <h1>Report Display Components - Live Demo</h1>
            <p class="lead">Interactive demonstration of the Report Viewer, Data Table, and Export components.</p>
            <div class="alert alert-info">
                <strong>Note:</strong> This is a standalone demo. In production, these components are integrated with Laravel Blade templates.
            </div>
        </div>

        <!-- Example 1: Full Report Viewer -->
        <div class="demo-section">
            <h2>Example 1: Complete Report Viewer</h2>
            <p>This example shows a full report with data table, pagination, and export buttons.</p>

            <div class="row mb-3">
                <div class="col">
                    <button class="btn btn-primary" id="loadReportBtn">Load Sample Report</button>
                    <button class="btn btn-secondary" id="showLoadingBtn">Show Loading State</button>
                    <button class="btn btn-warning" id="showEmptyBtn">Show Empty State</button>
                    <button class="btn btn-danger" id="showErrorBtn">Show Error State</button>
                </div>
            </div>

            <!-- Export Buttons Container -->
            <div class="mb-3">
                <div id="exportButtonsDemo"></div>
            </div>

            <!-- Report Display Container -->
            <div id="reportViewerDemo"></div>
        </div>

        <!-- Example 2: Standalone Data Table -->
        <div class="demo-section">
            <h2>Example 2: Standalone Data Table</h2>
            <p>Data table component with sorting and search functionality.</p>

            <div id="dataTableDemo"></div>
        </div>

        <!-- Example 3: Different Data Types -->
        <div class="demo-section">
            <h2>Example 3: Data Type Formatting</h2>
            <p>Demonstrates different data type formatting capabilities.</p>

            <div id="formattingDemo"></div>
        </div>

        <!-- Code Examples -->
        <div class="demo-section d-print-none">
            <h2>Code Examples</h2>

            <h4 class="mt-4">Basic Usage:</h4>
            <pre><code>// Initialize Report Viewer
const reportViewer = new ReportViewer('containerId', {
    showPagination: true,
    pageSize: 50
});

// Load data
reportViewer.render({
    success: true,
    report: { id: 1, name: 'Sample Report' },
    results: [...],
    columns: [...],
    meta: { total_rows: 100, page: 1, per_page: 50 }
}, 'tabular');</code></pre>

            <h4 class="mt-4">With Export Buttons:</h4>
            <pre><code>// Initialize Export Buttons
const exportButtons = new ExportButtons('exportContainer', {
    reportId: 123,
    formats: ['excel', 'pdf', 'csv'],
    apiEndpoint: '/api/reports/export'
});

exportButtons.setExportData({
    filters: { status: 'active' }
});</code></pre>
        </div>
    </div>

    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Component Scripts -->
    <script type="module">
        import ReportViewer from './ReportViewer.js';
        import DataTable from './DataTable.js';
        import ExportButtons from './ExportButtons.js';

        // Sample data
        const sampleReportData = {
            success: true,
            report: {
                id: 1,
                name: 'Student Fee Report',
                description: 'Outstanding fees by student for Academic Year 2024-2025',
                type: 'tabular',
                filters: {
                    academic_year: '2024-2025',
                    status: 'pending'
                }
            },
            results: [
                {
                    student_id: 1001,
                    name: 'John Doe',
                    grade: '10th',
                    amount_due: 5000,
                    amount_paid: 2000,
                    due_date: '2025-01-31',
                    status: 'pending',
                    percentage_paid: 40
                },
                {
                    student_id: 1002,
                    name: 'Jane Smith',
                    grade: '11th',
                    amount_due: 3000,
                    amount_paid: 3000,
                    due_date: '2025-01-15',
                    status: 'paid',
                    percentage_paid: 100
                },
                {
                    student_id: 1003,
                    name: 'Bob Johnson',
                    grade: '9th',
                    amount_due: 7500,
                    amount_paid: 0,
                    due_date: '2025-02-28',
                    status: 'overdue',
                    percentage_paid: 0
                },
                {
                    student_id: 1004,
                    name: 'Alice Williams',
                    grade: '12th',
                    amount_due: 4500,
                    amount_paid: 1500,
                    due_date: '2025-01-20',
                    status: 'pending',
                    percentage_paid: 33.33
                },
                {
                    student_id: 1005,
                    name: 'Charlie Brown',
                    grade: '10th',
                    amount_due: 6000,
                    amount_paid: 6000,
                    due_date: '2025-01-10',
                    status: 'paid',
                    percentage_paid: 100
                }
            ],
            columns: [
                { key: 'student_id', label: 'Student ID', type: 'number' },
                { key: 'name', label: 'Student Name', type: 'string' },
                { key: 'grade', label: 'Grade', type: 'string' },
                { key: 'amount_due', label: 'Amount Due', type: 'currency' },
                { key: 'amount_paid', label: 'Amount Paid', type: 'currency' },
                { key: 'percentage_paid', label: 'Paid %', type: 'percentage' },
                { key: 'due_date', label: 'Due Date', type: 'date' },
                { key: 'status', label: 'Status', type: 'status' }
            ],
            meta: {
                total_rows: 5,
                page: 1,
                per_page: 50
            }
        };

        // Example 1: Report Viewer
        const reportViewer = new ReportViewer('reportViewerDemo', {
            showPagination: true,
            pageSize: 50
        });

        const exportButtons = new ExportButtons('exportButtonsDemo', {
            reportId: 1,
            formats: ['excel', 'pdf', 'csv'],
            apiEndpoint: '/api/reports/export',
            onExportStart: (format) => {
                console.log('Export started:', format);
                alert(`Export to ${format.toUpperCase()} started (demo mode)`);
            }
        });

        // Button handlers
        document.getElementById('loadReportBtn').addEventListener('click', () => {
            reportViewer.render(sampleReportData, 'tabular');
        });

        document.getElementById('showLoadingBtn').addEventListener('click', () => {
            reportViewer.showLoading();
        });

        document.getElementById('showEmptyBtn').addEventListener('click', () => {
            reportViewer.render({
                success: true,
                results: [],
                columns: sampleReportData.columns,
                report: { name: 'Empty Report' }
            }, 'tabular');
        });

        document.getElementById('showErrorBtn').addEventListener('click', () => {
            reportViewer.render({
                success: false,
                message: 'Failed to load report data. Please try again.'
            }, 'tabular');
        });

        // Example 2: Standalone Data Table
        const dataTable = new DataTable({
            columns: [
                { key: 'id', label: 'ID', type: 'number' },
                { key: 'product', label: 'Product', type: 'string' },
                { key: 'price', label: 'Price', type: 'currency' },
                { key: 'stock', label: 'In Stock', type: 'boolean' },
                { key: 'last_updated', label: 'Last Updated', type: 'datetime' }
            ],
            data: [
                { id: 1, product: 'Laptop', price: 999.99, stock: true, last_updated: '2025-01-10T14:30:00' },
                { id: 2, product: 'Mouse', price: 29.99, stock: true, last_updated: '2025-01-11T10:15:00' },
                { id: 3, product: 'Keyboard', price: 79.99, stock: false, last_updated: '2025-01-09T16:45:00' },
                { id: 4, product: 'Monitor', price: 349.99, stock: true, last_updated: '2025-01-12T09:20:00' }
            ],
            sortable: true,
            searchable: true
        });

        dataTable.render(document.getElementById('dataTableDemo'));

        // Example 3: Formatting Demo
        const formattingTable = new DataTable({
            columns: [
                { key: 'type', label: 'Type', type: 'string' },
                { key: 'raw_value', label: 'Raw Value', type: 'string' },
                { key: 'formatted', label: 'Formatted Value', type: 'string' }
            ],
            data: [
                { type: 'Currency', raw_value: '1234.56', formatted: '$1,234.56' },
                { type: 'Date', raw_value: '2025-01-15', formatted: 'Jan 15, 2025' },
                { type: 'Number', raw_value: '1234567', formatted: '1,234,567' },
                { type: 'Percentage', raw_value: '45.67', formatted: '45.67%' },
                { type: 'Boolean', raw_value: 'true', formatted: 'Yes' },
                { type: 'Status', raw_value: 'paid', formatted: 'PAID (green)' }
            ],
            searchable: false,
            sortable: false
        });

        formattingTable.render(document.getElementById('formattingDemo'));

        // Auto-load on page load
        window.addEventListener('load', () => {
            reportViewer.render(sampleReportData, 'tabular');
        });
    </script>
</body>
</html>
